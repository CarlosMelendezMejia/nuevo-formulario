{% extends "base.html" %}

{% block title %}Confirmación de Asistencia - {{ evento.titulo }}{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="card border-top-c1 shadow-sm">
            <div class="card-header bg-c2 text-dark">
                <h2 class="h5 mb-0 fw-bold">{{ evento.titulo }}</h2>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <h3 class="h6 text-c3 fw-semibold mb-2">Bienvenida(o)</h3>
                    <p class="text-muted mb-2">
                        Le damos la más cordial bienvenida al formulario de confirmación de asistencia para el <b>Primer informe de actividades Gestión 2024 - 2028 Fes Aragón</b>.
                    </p>
                    <p class="text-muted mb-0">
                        Su registro nos permitirá organizar de manera adecuada el acceso, el control de asistentes y, en su caso, la logística de ingreso vehicular.
                    </p>
                </div>

                {% if evento.fecha_inicio or evento.lugar %}
                <div class="alert alert-info mb-4">
                    {% if evento.fecha_inicio %}
                    <p class="mb-1">
                        <strong>Fecha:</strong> 
                        {{ evento.fecha_inicio.strftime('%d/%m/%Y %H:%M') }}
                        {% if evento.fecha_fin %}
                        - {{ evento.fecha_fin.strftime('%H:%M') }}
                        {% endif %}
                    </p>
                    {% endif %}
                    {% if evento.lugar %}
                    <p class="mb-0"><strong>Lugar:</strong> {{ evento.lugar }}</p>
                    {% endif %}
                </div>
                {% endif %}

                <div class="card border-top-c2 shadow-sm mb-4">
                    <div class="card-header bg-c2 text-dark">
                        <h3 class="h6 mb-0 fw-bold">Ubicación: FES Aragón</h3>
                    </div>
                    <div class="card-body p-0">
                        <div id="map"
                             aria-label="Mapa de ubicación FES Aragón"
                             data-teatro-icon-url="{{ url_for('static', filename='img/teatro-jose-vasconcelos-marker.svg') }}"></div>
                    </div>
                </div>

                <p class="text-muted mb-4">
                    Por favor, complete el siguiente formulario para confirmar su asistencia al evento.
                    Los campos marcados con <span class="text-danger">*</span> son obligatorios.
                </p>

                <!-- Mensaje de error -->
                <div id="error-message" class="alert alert-danger" style="display: none;" role="alert"></div>

                <!-- Formulario -->
                <form id="confirmacion-form" novalidate>
                    <input type="hidden" name="id_evento" value="{{ evento.id }}">

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="dependencia" class="form-label">
                                Dependencia <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="dependencia" name="dependencia" maxlength="255" required>
                        </div>

                        <div class="col-md-6">
                            <label for="puesto" class="form-label">
                                Puesto <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="puesto" name="puesto" maxlength="255" required>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label for="grado" class="form-label">
                                Grado <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="grado" name="grado" required>
                                <option value="">Seleccione...</option>
                                <option value="Dr.">Dr.</option>
                                <option value="Dra.">Dra.</option>
                                <option value="Mtro.">Mtro.</option>
                                <option value="Mtra.">Mtra.</option>
                                <option value="Lic.">Lic.</option>
                                <option value="Ing.">Ing.</option>
                                <option value="Arq.">Arq.</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>

                        <div class="col-md-9">
                            <label for="nombre_completo" class="form-label">
                                Nombre Completo <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="nombre_completo" name="nombre_completo" 
                                   placeholder="Sin incluir el grado" maxlength="255" required>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="mb-3">
                        <label class="form-label fw-bold d-block mb-2">
                            ¿Asistirá con vehículo? <span class="text-danger">*</span>
                        </label>
                        <div class="d-flex flex-column gap-2">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" id="trae_vehiculo_si" name="trae_vehiculo" value="si" required>
                                <label class="form-check-label" for="trae_vehiculo_si">
                                    Sí, soy externo a FES Aragón y asistiré con vehículo
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" id="trae_vehiculo_no" name="trae_vehiculo" value="no">
                                <label class="form-check-label" for="trae_vehiculo_no">
                                    No
                                </label>
                            </div>
                        </div>
                        <small class="text-muted">En caso de formar parte de la comunidad de FES Aragón y contar con tarjeta de proximidad, marque "No" y el ingreso con su vehiculo sera normal</small>
                    </div>

                    <div id="vehiculo_fields" style="display: none;">
                        <div class="alert alert-warning mb-3">
                            <small>Si trae vehículo, los siguientes campos son obligatorios:</small>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="vehiculo_modelo" class="form-label">
                                    Modelo del Vehículo <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="vehiculo_modelo" 
                                       name="vehiculo_modelo" placeholder="Ej: Toyota Corolla 2020" maxlength="100">
                            </div>

                            <div class="col-md-6">
                                <label for="vehiculo_color" class="form-label">
                                    Color del Vehículo <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="vehiculo_color" 
                                       name="vehiculo_color" placeholder="Ej: Blanco" maxlength="50">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="vehiculo_placas" class="form-label">
                                Placas del Vehículo <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="vehiculo_placas" 
                                   name="vehiculo_placas" placeholder="Ej: ABC-123-D" 
                                   maxlength="20" autocapitalize="characters" autocomplete="off"
                                   style="text-transform: uppercase;">
                            <small class="text-muted">Las placas se guardarán en mayúsculas sin espacios ni guiones</small>
                        </div>
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <span id="submitText"><i class="bi bi-check2-circle me-2" aria-hidden="true"></i>Confirmar Asistencia</span>
                            <span id="submitSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;" role="status">
                                <span class="visually-hidden">Procesando...</span>
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>
<script src="{{ url_for('static', filename='js/form.js') }}"></script>
{% endblock %}
